!function(l){var e=function(e,n){var o=l(e),a=this,t=l.extend({debug:!1,url:null,collapsible:!0,collapsed:null,autorefresh:null,refreshable:!0},n||{}),s={body:null,header:null,collapsed:null,collapseBtn:null,collapseIcon:null,reloadBtn:null,idleIcon:null,idle:!1,autorefreshIv:null};this.abort=function(){this.debug("Panel->abort"),s.xhr&&(s.xhr.abort(),r("panel-abort"),d(!1))},this.isIdle=function(){return s.idle},this.loadContents=function(){this.isIdle()&&this.abort(),this.debug("Panel->loadContents"),d(!0),s.xhr=l.ajax({url:t.url,dataType:"html",context:this,error:function(l,e,n){a.debug("Panel->loadContents",l,e,n),d(!1),s.xhr=null,r("panel-error-content",{jqXHR:l,textStatus:e,errorThrown:n}),s.body.html(e+"<br>\n"+n)},success:function(l){a.debug("Panel->loadContents",l),d(!1),s.xhr=null,r("panel-before-content",{data:l}),s.body.html(l),a.isCollapsedDefined()||a.collapse(!1),r("panel-after-content",{data:l}),o.scrollTop(),a.refreshInterval()}})},this.refreshInterval=function(){isNaN(t.autorefresh)||!isNaN(t.autorefresh)&&t.autorefresh<=1||(clearInterval(t.autorefreshIv),s.autorefreshIv=setTimeout(function(){a.loadContents()},1e3*t.autorefresh))},this.isCollapsed=function(){return s.collapsed},this.isCollapsedDefined=function(){return!(null===t.collapsed)},this.collapse=function(l){l!=s.collapsed&&(this.debug("Panel->collapse",l),s.collapsed=l,s.body&&(s.collapsed?(s.body.slideUp(),s.collapseIcon&&s.collapseIcon.hasClass("glyphicon-chevron-up")&&s.collapseIcon.removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down")):(s.body.slideDown(),s.collapseIcon&&s.collapseIcon.hasClass("glyphicon-chevron-down")&&s.collapseIcon.removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up"))))},this.debug=function(){t.debug&&window.console&&window.console.log&&window.console.log(arguments)};var d=function(l){l!==s.idle&&(s.idle=l,s.idle?(s.reloadBtn&&s.reloadBtn.attr("disabled","disabled"),s.body&&s.body.fadeTo("fast",.5),s.idleIcon&&s.idleIcon.show()):(s.reloadBtn&&s.reloadBtn.removeAttr("disabled"),s.body&&s.body.fadeTo("slow",1),s.idleIcon&&s.idleIcon.hide()),a.debug("Panel->__setIdle",s.idle),r("panel-idle-changed",{idle:s.idle}))},r=function(l,e){var n=jQuery.Event(l);for(var a in e)n[a]=e[a];o.trigger(n)},i=function(){for(var l in t)void 0!==o.attr("data-"+l)&&(t[l]=o.attr("data-"+l));s.body=o.find(".panel-body").first(),s.collapsed=a.isCollapsedDefined()?t.collapsed:null===t.url?!1:!0,t.collapsible&&(s.collapseBtn=o.find(".btn-panel-toggle-collapse").first(),s.collapseIcon=o.find(".panel-collapse-icon").first(),s.collapseBtn&&s.collapseBtn.on("click",function(l){l.preventDefault(),a.collapse(a.isCollapsed()?!1:!0)})),r("panel-complete",{collapsed:a.isCollapsed()}),t.url&&(s.idleIcon=o.find(".panel-idle-icon").first(),s.idleIcon&&s.idleIcon.hide(),s.reloadBtn=o.find(".btn-panel-reload"),s.reloadBtn&&s.reloadBtn.on("click",function(l){l.preventDefault(),a.loadContents()}),a.loadContents())};i()};l.fn.panel=function(n){return this.each(function(){var o=l(this);if(!o.data("panel")){var a=new e(this,n);o.data("panel",a)}})}}(jQuery);
